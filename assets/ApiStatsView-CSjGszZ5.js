import{aP as vt,r as j,c as D,aX as st,x as n,y as r,z as t,O as h,L as A,P as i,u as e,C as K,K as ct,aq as ft,aa as mt,f as gt,Y as yt,Q as tt,ac as et,aT as nt,B as H,R as Z,o as bt,V as pt,I as ot,a5 as kt,q as ht,aW as _t,J as xt,av as wt}from"./vue-vendor-Bsazo-x0.js";import{_ as at,A as $t,a as St}from"./index-DMLho88f.js";import{L as Ct}from"./LogoTitle-D2OHeKkA.js";import{T as Tt}from"./ThemeToggle-DQX7R3CY.js";import{b as Kt}from"./vendor-Dr8jvgFu.js";import{_ as At}from"./WindowCountdown-BTXjZ8Dc.js";import Pt from"./TutorialView-C3XAC-4g.js";import"./element-plus-CqiD73Lu.js";class Lt{constructor(){this.baseURL=window.location.origin,this.isDev=!1}async request(y,a={}){try{this.isDev&&y.startsWith("/admin")&&(y="/webapi"+y);const x=await fetch(`${this.baseURL}${y}`,{headers:{"Content-Type":"application/json",...a.headers},...a}),d=await x.json();if(!x.ok)throw new Error(d.message||`请求失败: ${x.status}`);return d}catch(x){throw console.error("API Stats request error:",x),x}}async getKeyId(y){return this.request("/apiStats/api/get-key-id",{method:"POST",body:JSON.stringify({apiKey:y})})}async getUserStats(y){return this.request("/apiStats/api/user-stats",{method:"POST",body:JSON.stringify({apiId:y})})}async getUserModelStats(y,a="daily"){return this.request("/apiStats/api/user-model-stats",{method:"POST",body:JSON.stringify({apiId:y,period:a})})}async getOemSettings(){try{return await this.request("/admin/oem-settings")}catch(y){return console.error("Failed to load OEM settings:",y),{success:!0,data:{siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}}}async getBatchStats(y){return this.request("/apiStats/api/batch-stats",{method:"POST",body:JSON.stringify({apiIds:y})})}async getBatchModelStats(y,a="daily"){return this.request("/apiStats/api/batch-model-stats",{method:"POST",body:JSON.stringify({apiIds:y,period:a})})}}const X=new Lt,lt=vt("apistats",()=>{const R=j(""),y=j(null),a=j(!1),x=j(!1),d=j(!0),b=j(""),m=j("daily"),c=j(null),_=j([]),P=j(null),p=j(null),C=j({siteName:"",siteIcon:"",siteIconData:""}),N=j(!1),W=j([]),v=j([]),u=j(null),l=j([]),T=j([]),O=D(()=>{const f={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};return N.value&&u.value?m.value==="daily"?u.value.dailyUsage||f:u.value.monthlyUsage||f:m.value==="daily"?P.value||f:p.value||f}),B=D(()=>{if(!c.value||!O.value)return{tokenUsage:0,costUsage:0,requestUsage:0};const f=O.value,k=c.value.limits;return{tokenUsage:k.tokenLimit>0?Math.min(f.allTokens/k.tokenLimit*100,100):0,costUsage:k.dailyCostLimit>0?Math.min(f.cost/k.dailyCostLimit*100,100):0,requestUsage:k.rateLimitRequests>0?Math.min(f.requests/k.rateLimitRequests*100,100):0}});async function G(){if(N.value)return Y();const f=R.value.trim();if(!f){b.value="请输入 API Key";return}if(f.length<10||f.length>512){b.value="API Key 格式无效：长度应在 10-512 个字符之间";return}a.value=!0,b.value="",c.value=null,_.value=[],y.value=null;try{const k=await X.getKeyId(f);if(k.success){y.value=k.data.id;const L=await X.getUserStats(y.value);if(L.success)c.value=L.data,await E(),b.value="",z();else throw new Error(L.message||"查询失败")}else throw new Error(k.message||"获取 API Key ID 失败")}catch(k){console.error("Query stats error:",k),b.value=k.message||"查询统计数据失败，请检查您的 API Key 是否正确",c.value=null,_.value=[],y.value=null}finally{a.value=!1}}async function E(){y.value&&(await Promise.all([V("daily"),V("monthly")]),await M(m.value))}async function V(f){try{const k=await X.getUserModelStats(y.value,f);if(k.success){const L=k.data||[],F={requests:0,inputTokens:0,outputTokens:0,cacheCreateTokens:0,cacheReadTokens:0,allTokens:0,cost:0,formattedCost:"$0.000000"};L.forEach(I=>{var J;F.requests+=I.requests||0,F.inputTokens+=I.inputTokens||0,F.outputTokens+=I.outputTokens||0,F.cacheCreateTokens+=I.cacheCreateTokens||0,F.cacheReadTokens+=I.cacheReadTokens||0,F.allTokens+=I.allTokens||0,F.cost+=((J=I.costs)==null?void 0:J.total)||0}),F.formattedCost=Q(F.cost),f==="daily"?P.value=F:p.value=F}else console.warn(`Failed to load ${f} stats:`,k.message)}catch(k){console.error(`Load ${f} stats error:`,k)}}async function M(f="daily"){if(y.value){x.value=!0;try{const k=await X.getUserModelStats(y.value,f);if(k.success)_.value=k.data||[];else throw new Error(k.message||"加载模型统计失败")}catch(k){console.error("Load model stats error:",k),_.value=[]}finally{x.value=!1}}}async function $(f){if(!(m.value===f||x.value)){if(m.value=f,N.value&&v.value.length>0){await rt(f);return}(f==="daily"&&!P.value||f==="monthly"&&!p.value)&&await V(f),await M(f)}}async function q(){var f,k;if(y.value){a.value=!0,b.value="",c.value=null,_.value=[];try{const L=await X.getUserStats(y.value);if(L.success)c.value=L.data,console.log("API Stats - Full response:",L.data),console.log("API Stats - limits data:",L.data.limits),console.log("API Stats - weeklyOpusCostLimit:",(f=L.data.limits)==null?void 0:f.weeklyOpusCostLimit),console.log("API Stats - weeklyOpusCost:",(k=L.data.limits)==null?void 0:k.weeklyOpusCost),await E(),b.value="";else throw new Error(L.message||"查询失败")}catch(L){console.error("Load stats with apiId error:",L),b.value=L.message||"查询统计数据失败",c.value=null,_.value=[]}finally{a.value=!1}}}async function w(){d.value=!0;try{const f=await X.getOemSettings();f&&f.success&&f.data&&(C.value={...C.value,...f.data})}catch(f){console.error("Error loading OEM settings:",f),C.value={siteName:"Claude Relay Service",siteIcon:"",siteIconData:""}}finally{d.value=!1}}function Q(f){return typeof f!="number"||f===0?"$0.000000":f>=1?"$"+f.toFixed(2):f>=.01?"$"+f.toFixed(4):"$"+f.toFixed(6)}function z(){if(y.value){const f=new URL(window.location);f.searchParams.set("apiId",y.value),window.history.pushState({},"",f)}}async function Y(){const f=o();if(f.length===0){b.value="请输入至少一个有效的 API Key";return}a.value=!0,b.value="",u.value=null,l.value=[],T.value=[],_.value=[],W.value=f,v.value=[];try{const k=await Promise.allSettled(f.map(J=>X.getKeyId(J))),L=[],F=[];if(k.forEach((J,it)=>{J.status==="fulfilled"&&J.value.success?(L.push(J.value.data.id),F.push(f[it])):T.value.push(f[it])}),L.length===0)throw new Error("所有 API Key 都无效");v.value=L,W.value=F;const I=await X.getBatchStats(L);if(I.success)u.value=I.data.aggregated,l.value=I.data.individual,c.value=I.data.aggregated,P.value=I.data.aggregated.dailyUsage||null,p.value=I.data.aggregated.monthlyUsage||null,await rt(m.value),s();else throw new Error(I.message||"批量查询失败")}catch(k){console.error("Batch query error:",k),b.value=k.message||"批量查询统计数据失败",u.value=null,l.value=[]}finally{a.value=!1}}async function rt(f="daily"){if(v.value.length!==0){x.value=!0;try{const k=await X.getBatchModelStats(v.value,f);if(k.success)_.value=k.data||[];else throw new Error(k.message||"加载批量模型统计失败")}catch(k){console.error("Load batch model stats error:",k),_.value=[]}finally{x.value=!1}}}function o(){if(!R.value)return[];const f=R.value.split(/[,\n]+/).map(L=>L.trim()).filter(L=>L.length>=10&&L.length<=512);return[...new Set(f)].slice(0,30)}function s(){if(v.value.length>0){const f=new URL(window.location);f.searchParams.set("apiIds",v.value.join(",")),f.searchParams.set("batch","true"),window.history.pushState({},"",f)}}function g(){R.value=""}function S(){c.value=null,_.value=[],P.value=null,p.value=null,b.value="",m.value="daily",y.value=null,W.value=[],v.value=[],u.value=null,l.value=[],T.value=[]}function U(){R.value="",N.value=!1,S()}return{apiKey:R,apiId:y,loading:a,modelStatsLoading:x,oemLoading:d,error:b,statsPeriod:m,statsData:c,modelStats:_,dailyStats:P,monthlyStats:p,oemSettings:C,multiKeyMode:N,apiKeys:W,apiIds:v,aggregatedStats:u,individualStats:l,invalidKeys:T,currentPeriodData:O,usagePercentages:B,queryStats:G,queryBatchStats:Y,loadAllPeriodStats:E,loadPeriodStats:V,loadModelStats:M,loadBatchModelStats:rt,switchPeriod:$,loadStatsWithApiId:q,loadOemSettings:w,clearData:S,clearInput:g,reset:U}}),jt={class:"api-input-wide-card mb-8 rounded-3xl p-6 shadow-xl"},Mt={class:"mx-auto max-w-4xl"},It={class:"control-bar mb-4 flex flex-wrap items-center justify-between gap-3"},Dt={class:"text-sm font-medium text-gray-700 dark:text-gray-300"},qt={class:"button-group flex items-center gap-2"},Ut={class:"mode-switch-group flex items-center rounded-lg bg-gray-100 p-1 dark:bg-gray-800"},Rt={key:0,class:"ml-1 rounded-full bg-white/20 px-1.5 py-0.5 text-xs font-semibold"},Nt={class:"api-input-grid grid grid-cols-1 gap-4 lg:grid-cols-4"},Ot={class:"lg:col-span-3"},Et=["disabled"],Ft={key:1,class:"relative"},Wt=["disabled"],Bt={class:"lg:col-span-1"},Vt=["disabled"],zt={key:0,class:"fas fa-spinner loading-spinner"},Jt={key:1,class:"fas fa-search"},Yt={class:"security-notice mt-4"},Ht={key:0,class:"mt-2 rounded-lg bg-blue-50 p-3 text-sm text-blue-700 dark:bg-blue-900/20 dark:text-blue-400"},Gt={__name:"ApiKeyInput",setup(R){const y=lt(),{apiKey:a,loading:x,multiKeyMode:d}=st(y),{queryStats:b,clearInput:m}=y,c=D(()=>{if(!d.value||!a.value)return[];const P=a.value.split(/[,\n]+/).map(C=>C.trim()).filter(C=>C.length>0);return[...new Set(P)].slice(0,30)}),_=D(()=>d.value?c.value.length>0:a.value&&a.value.trim().length>0);return(P,p)=>(r(),n("div",jt,[p[15]||(p[15]=t("div",{class:"wide-card-title mb-6"},[t("h2",{class:"mb-2 text-2xl font-bold text-gray-900 dark:text-gray-200"},[t("i",{class:"fas fa-chart-line mr-3"}),h(" 使用统计查询 ")]),t("p",{class:"text-base text-gray-600 dark:text-gray-400"},"查询您的 API Key 使用情况和统计数据")],-1)),t("div",Mt,[t("div",It,[t("label",Dt,[p[8]||(p[8]=t("i",{class:"fas fa-key mr-2"},null,-1)),h(" "+i(e(d)?"输入您的 API Keys（每行一个或用逗号分隔）":"输入您的 API Key"),1)]),t("div",qt,[t("div",Ut,[t("button",{class:K(["mode-switch-btn",{active:!e(d)}]),title:"单一模式",onClick:p[0]||(p[0]=C=>d.value=!1)},p[9]||(p[9]=[t("i",{class:"fas fa-key"},null,-1),t("span",{class:"ml-2 hidden sm:inline"},"单一",-1)]),2),t("button",{class:K(["mode-switch-btn",{active:e(d)}]),title:"聚合模式",onClick:p[1]||(p[1]=C=>d.value=!0)},[p[10]||(p[10]=t("i",{class:"fas fa-layer-group"},null,-1)),p[11]||(p[11]=t("span",{class:"ml-2 hidden sm:inline"},"聚合",-1)),e(d)&&c.value.length>0?(r(),n("span",Rt,i(c.value.length),1)):A("",!0)],2)])])]),t("div",Nt,[t("div",Ot,[e(d)?(r(),n("div",Ft,[ct(t("textarea",{"onUpdate:modelValue":p[4]||(p[4]=C=>gt(a)?a.value=C:null),class:"wide-card-input w-full resize-y",disabled:e(x),placeholder:`请输入您的 API Keys，支持以下格式：
cr_xxx
cr_yyy
或
cr_xxx, cr_yyy`,rows:"4",onKeyup:p[5]||(p[5]=mt(yt((...C)=>e(b)&&e(b)(...C),["ctrl"]),["enter"]))},null,40,Wt),[[ft,e(a)]]),e(a)&&!e(x)?(r(),n("button",{key:0,class:"absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:text-gray-500 dark:hover:text-gray-300",title:"清空输入",onClick:p[6]||(p[6]=(...C)=>e(m)&&e(m)(...C))},p[12]||(p[12]=[t("i",{class:"fas fa-times-circle"},null,-1)]))):A("",!0)])):ct((r(),n("input",{key:0,"onUpdate:modelValue":p[2]||(p[2]=C=>gt(a)?a.value=C:null),class:"wide-card-input w-full",disabled:e(x),placeholder:"请输入您的 API Key (cr_...)",type:"password",onKeyup:p[3]||(p[3]=mt((...C)=>e(b)&&e(b)(...C),["enter"]))},null,40,Et)),[[ft,e(a)]])]),t("div",Bt,[t("button",{class:"btn btn-primary btn-query flex h-full w-full items-center justify-center gap-2",disabled:e(x)||!_.value,onClick:p[7]||(p[7]=(...C)=>e(b)&&e(b)(...C))},[e(x)?(r(),n("i",zt)):(r(),n("i",Jt)),h(" "+i(e(x)?"查询中...":"查询统计"),1)],8,Vt)])]),t("div",Yt,[p[13]||(p[13]=t("i",{class:"fas fa-shield-alt mr-2"},null,-1)),h(" "+i(e(d)?"您的 API Keys 仅用于查询统计数据，不会被存储。聚合模式下部分个体化信息将不显示。":"您的 API Key 仅用于查询自己的统计数据，不会被存储或用于其他用途"),1)]),e(d)?(r(),n("div",Ht,p[14]||(p[14]=[t("i",{class:"fas fa-lightbulb mr-2"},null,-1),t("span",null,"提示：最多支持同时查询 30 个 API Keys。使用 Ctrl+Enter 快速查询。",-1)]))):A("",!0)])]))}},Qt=at(Gt,[["__scopeId","data-v-11e74200"]]),Xt={class:"space-y-6 md:space-y-8"},Zt={class:"grid grid-cols-1 items-start gap-4 md:gap-6 xl:grid-cols-[minmax(0,1.5fr)_minmax(0,1fr)]"},te={class:"card-section h-full"},ee={class:"section-header"},se={class:"header-title"},ae={class:"header-subtitle"},le={key:0,class:"info-grid"},re={class:"info-item group"},ie={class:"info-value"},oe={class:"info-item group"},ne={class:"info-value text-emerald-600 dark:text-emerald-400"},de={key:0,class:"info-item group"},ue={class:"info-value text-red-500 dark:text-red-400"},ce={class:"info-item group"},fe={class:"info-value"},me={class:"info-item group"},ge={class:"info-value"},xe={class:"info-item group"},be={class:"info-value text-indigo-600 dark:text-indigo-300"},pe={key:1,class:"info-item !flex-col !items-start gap-3 xl:col-span-2"},ve={class:"w-full space-y-2"},ye={class:"flex min-w-0 items-center gap-2"},ke={class:"truncate text-xs font-medium"},he={class:"font-mono text-xs font-bold text-slate-700 dark:text-slate-200"},_e={key:1,class:"info-grid"},we={class:"info-item group"},$e={class:"min-w-0"},Se=["title"],Ce={class:"info-item group"},Te={class:"info-item group"},Ke={class:"info-value"},Ae={class:"info-item group"},Pe={class:"info-value text-xs"},Le={class:"info-item group xl:col-span-2"},je={class:"info-value"},Me={class:"ml-2 text-xs text-gray-500 dark:text-gray-400"},Ie={key:0,class:"font-medium text-red-500 dark:text-red-400"},De={key:1,class:"font-medium text-orange-500 dark:text-orange-400"},qe={key:2},Ue={key:2,class:"font-medium text-emerald-600 dark:text-emerald-400"},Re={class:"card-section h-full"},Ne={class:"section-header"},Oe={class:"header-subtitle"},Ee={class:"header-tag ml-auto"},Fe={class:"metric-grid"},We={class:"metric-card group"},Be={class:"metric-content"},Ve={class:"metric-value text-emerald-600 dark:text-emerald-400"},ze={class:"metric-card group"},Je={class:"metric-content"},Ye={class:"metric-value text-blue-600 dark:text-blue-400"},He={class:"metric-card group"},Ge={class:"metric-content"},Qe={class:"metric-value text-violet-600 dark:text-violet-400"},Xe={class:"metric-card group"},Ze={class:"metric-content"},ts={class:"metric-value text-amber-600 dark:text-amber-400"},es={key:0,class:"card-section"},ss={class:"mb-4 flex items-center justify-between gap-3"},as={class:"flex items-center gap-3"},ls={class:"account-name"},rs={class:"account-sub"},is={key:0,class:"mt-3 space-y-3"},os={class:"progress-container"},ns={class:"mb-1 flex justify-between text-xs"},ds={class:"font-bold text-slate-700 dark:text-slate-200"},us={class:"progress-track"},cs={class:"flex flex-wrap items-center justify-between gap-2 rounded-lg bg-slate-50 p-2 text-xs text-slate-500 dark:bg-slate-800/50 dark:text-slate-400"},fs={class:"flex items-center gap-1.5"},ms={key:0,class:"rounded bg-indigo-50 px-2 py-0.5 font-medium text-indigo-600 dark:bg-indigo-900/20 dark:text-indigo-400"},gs={key:1,class:"mt-3"},xs={key:0,class:"space-y-3"},bs={class:"quota-header"},ps={class:"quota-percent"},vs={class:"progress-track mt-2"},ys={class:"quota-foot"},ks={key:1,class:"rounded-xl border border-dashed border-slate-200 bg-slate-50 px-4 py-3 text-center text-xs text-slate-500 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-400"},hs={__name:"StatsOverview",setup(R){const y=lt(),{statsData:a,statsPeriod:x,currentPeriodData:d,multiKeyMode:b,aggregatedStats:m,individualStats:c,invalidKeys:_}=st(y),P=D(()=>!c.value||c.value.length===0?[]:[...c.value].sort((o,s)=>{var g,S;return(((g=s.usage)==null?void 0:g.allTokens)||0)-(((S=o.usage)==null?void 0:S.allTokens)||0)}).slice(0,3)),p=o=>{var g;return!m.value||!m.value.usage.allTokens?0:((((g=o.usage)==null?void 0:g.allTokens)||0)/m.value.usage.allTokens*100).toFixed(1)},C=o=>{if(!o)return"无";try{return Kt(o).format("YYYY年MM月DD日 HH:mm")}catch{return"格式错误"}},N=o=>o?new Date(o).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"",W=o=>o?new Date(o)<new Date:!1,v=o=>{if(!o)return!1;const S=(new Date(o)-new Date)/(1e3*60*60*24);return S>0&&S<=7},u=o=>(typeof o!="number"&&(o=parseInt(o)||0),o===0?"0":o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(1)+"K":o.toLocaleString()),l=o=>({claude:"Claude",gemini:"Gemini",all:"全部模型"})[o]||o||"未知",T=D(()=>{var g,S;const o=(S=(g=a.value)==null?void 0:g.accounts)==null?void 0:S.details;if(!o)return[];const s=[];return o.claude&&o.claude.accountType==="dedicated"&&s.push({key:"claude",...o.claude}),o.openai&&o.openai.accountType==="dedicated"&&s.push({key:"openai",...o.openai}),s}),O=D(()=>{const o=T.value.length;return o<=1?"md:grid-cols-1 lg:grid-cols-1":o===2?"md:grid-cols-2":"md:grid-cols-2 xl:grid-cols-3"}),B=o=>o?o.platform==="openai"?"OpenAI 专属账号":"Claude 专属账号":"专属账号",G=o=>{if(!o||o<=0)return"";const s=Math.floor(o),g=Math.floor(s/1440),S=Math.floor(s%1440/60),U=s%60;return g>0?S>0?`${g}天${S}小时`:`${g}天`:S>0?U>0?`${S}小时${U}分钟`:`${S}小时`:`${U}分钟`},E=o=>{if(!o)return{text:"状态未知",class:"text-gray-400"};if(o.isRateLimited){const s=G(o.minutesRemaining);return{text:`限流中${s?` · 剩余约 ${s}`:""}`,class:"text-red-500 dark:text-red-400"}}return{text:"未限流",class:"text-green-600 dark:text-emerald-400"}},V=(o,s)=>{if(!o||!s)return"暂无时间窗口信息";const g=new Date(o),S=new Date(s),U=f=>`${`${f.getHours()}`.padStart(2,"0")}:${`${f.getMinutes()}`.padStart(2,"0")}`;return`${U(g)} - ${U(S)}`},M=o=>{if(!o||o<=0)return"";const s=Math.floor(o/60),g=o%60;return s>0?`${s}小时${g}分钟`:`${g}分钟`},$=(o,s)=>{var S;if(!o)return"bg-gradient-to-r from-blue-500 to-indigo-500";if((S=s==null?void 0:s.rateLimitStatus)!=null&&S.isRateLimited)return"bg-gradient-to-r from-red-500 to-red-600";const g=String(o).toLowerCase();return g==="rejected"?"bg-gradient-to-r from-red-500 to-red-600":g==="allowed_warning"?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-blue-500 to-indigo-500"},q=o=>{if(!o)return null;const s=typeof o.usedPercent=="number"&&!Number.isNaN(o.usedPercent)?o.usedPercent:null,g=typeof o.resetAfterSeconds=="number"&&!Number.isNaN(o.resetAfterSeconds)?o.resetAfterSeconds:null,S=typeof o.remainingSeconds=="number"?o.remainingSeconds:null,U=o.resetAt?Date.parse(o.resetAt):null;return g!==null&&(S!==null&&S<=0||U!==null&&!Number.isNaN(U)&&Date.now()>=U)?0:s===null?null:Math.max(0,Math.min(100,s))},w=o=>{const s=q(o);return s===null?"bg-gradient-to-r from-gray-300 to-gray-400":s>=90?"bg-gradient-to-r from-red-500 to-red-600":s>=75?"bg-gradient-to-r from-yellow-500 to-orange-500":"bg-gradient-to-r from-emerald-500 to-teal-500"},Q=o=>{const s=q(o);return s===null?"0%":`${s}%`},z=o=>{const s=q(o);return s===null?"--":`${s.toFixed(1)}%`},Y=o=>{if(!o)return"--";let s=o.remainingSeconds;if(s==null&&(s=o.resetAfterSeconds),s==null||Number.isNaN(Number(s)))return"--";s=Math.max(0,Math.floor(Number(s)));const g=Math.floor(s/86400),S=Math.floor(s%86400/3600),U=Math.floor(s%3600/60),f=s%60;return g>0?S>0?`${g}天${S}小时`:`${g}天`:S>0?U>0?`${S}小时${U}分钟`:`${S}小时`:U>0?`${U}分钟`:`${f}秒`},rt=o=>o==="secondary"?"周限":"5h";return(o,s)=>(r(),n("div",Xt,[t("div",Zt,[t("div",te,[t("header",ee,[t("div",{class:K(["header-icon-wrapper",e(b)?"bg-purple-100 dark:bg-purple-900/30":"bg-blue-100 dark:bg-blue-900/30"])},[t("i",{class:K(["header-icon",e(b)?"fas fa-layer-group text-purple-600 dark:text-purple-400":"fas fa-info-circle text-blue-600 dark:text-blue-400"])},null,2)],2),t("div",null,[t("h3",se,i(e(b)?"批量查询概要":"API Key 信息"),1),t("p",ae,i(e(b)?"多Key聚合统计数据":"当前Key的基础信息"),1)])]),e(b)&&e(m)?(r(),n("div",le,[t("div",re,[s[1]||(s[1]=t("div",{class:"info-icon bg-indigo-50 text-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-400"},[t("i",{class:"fas fa-key"})],-1)),t("div",null,[s[0]||(s[0]=t("p",{class:"info-label"},"查询 Keys 数",-1)),t("p",ie,i(e(m).totalKeys)+" 个",1)])]),t("div",oe,[s[3]||(s[3]=t("div",{class:"info-icon bg-emerald-50 text-emerald-500 dark:bg-emerald-900/20 dark:text-emerald-400"},[t("i",{class:"fas fa-check-circle"})],-1)),t("div",null,[s[2]||(s[2]=t("p",{class:"info-label"},"有效 Keys 数",-1)),t("p",ne,i(e(m).activeKeys)+" 个 ",1)])]),e(_).length>0?(r(),n("div",de,[s[5]||(s[5]=t("div",{class:"info-icon bg-red-50 text-red-500 dark:bg-red-900/20 dark:text-red-400"},[t("i",{class:"fas fa-times-circle"})],-1)),t("div",null,[s[4]||(s[4]=t("p",{class:"info-label"},"无效 Keys 数",-1)),t("p",ue,i(e(_).length)+" 个",1)])])):A("",!0),t("div",ce,[s[7]||(s[7]=t("div",{class:"info-icon bg-blue-50 text-blue-500 dark:bg-blue-900/20 dark:text-blue-400"},[t("i",{class:"fas fa-exchange-alt"})],-1)),t("div",null,[s[6]||(s[6]=t("p",{class:"info-label"},"总请求数",-1)),t("p",fe,i(u(e(m).usage.requests)),1)])]),t("div",me,[s[9]||(s[9]=t("div",{class:"info-icon bg-violet-50 text-violet-500 dark:bg-violet-900/20 dark:text-violet-400"},[t("i",{class:"fas fa-coins"})],-1)),t("div",null,[s[8]||(s[8]=t("p",{class:"info-label"},"总 Token 数",-1)),t("p",ge,i(u(e(m).usage.allTokens)),1)])]),t("div",xe,[s[11]||(s[11]=t("div",{class:"info-icon bg-amber-50 text-amber-500 dark:bg-amber-900/20 dark:text-amber-400"},[t("i",{class:"fas fa-dollar-sign"})],-1)),t("div",null,[s[10]||(s[10]=t("p",{class:"info-label"},"总费用",-1)),t("p",be,i(e(m).usage.formattedCost),1)])]),e(c).length>1?(r(),n("div",pe,[s[13]||(s[13]=t("p",{class:"info-label"},"Top 3 贡献占比",-1)),t("div",ve,[(r(!0),n(tt,null,et(P.value,g=>(r(),n("div",{key:g.apiId,class:"contributor-item"},[t("div",ye,[s[12]||(s[12]=t("div",{class:"h-2 w-2 rounded-full bg-blue-500"},null,-1)),t("span",ke,i(g.name),1)]),t("span",he,i(p(g))+"%",1)]))),128))])])):A("",!0)])):(r(),n("div",_e,[t("div",we,[s[15]||(s[15]=t("div",{class:"info-icon bg-slate-50 text-slate-500 dark:bg-slate-800 dark:text-slate-400"},[t("i",{class:"fas fa-signature"})],-1)),t("div",$e,[s[14]||(s[14]=t("p",{class:"info-label"},"名称",-1)),t("p",{class:"info-value truncate",title:e(a).name},i(e(a).name),9,Se)])]),t("div",Ce,[t("div",{class:K(["info-icon",e(a).isActive?"bg-emerald-50 text-emerald-500 dark:bg-emerald-900/20 dark:text-emerald-400":"bg-red-50 text-red-500 dark:bg-red-900/20 dark:text-red-400"])},[t("i",{class:K(e(a).isActive?"fas fa-check-circle":"fas fa-times-circle")},null,2)],2),t("div",null,[s[16]||(s[16]=t("p",{class:"info-label"},"状态",-1)),t("p",{class:K(["info-value font-semibold",e(a).isActive?"text-emerald-600 dark:text-emerald-400":"text-red-500 dark:text-red-400"])},i(e(a).isActive?"活跃":"已停用"),3)])]),t("div",Te,[s[18]||(s[18]=t("div",{class:"info-icon bg-indigo-50 text-indigo-500 dark:bg-indigo-900/20 dark:text-indigo-400"},[t("i",{class:"fas fa-shield-alt"})],-1)),t("div",null,[s[17]||(s[17]=t("p",{class:"info-label"},"权限",-1)),t("p",Ke,i(l(e(a).permissions)),1)])]),t("div",Ae,[s[20]||(s[20]=t("div",{class:"info-icon bg-blue-50 text-blue-500 dark:bg-blue-900/20 dark:text-blue-400"},[t("i",{class:"fas fa-calendar-plus"})],-1)),t("div",null,[s[19]||(s[19]=t("p",{class:"info-label"},"创建时间",-1)),t("p",Pe,i(C(e(a).createdAt)),1)])]),t("div",Le,[s[26]||(s[26]=t("div",{class:"info-icon bg-amber-50 text-amber-500 dark:bg-amber-900/20 dark:text-amber-400"},[t("i",{class:"fas fa-hourglass-half"})],-1)),t("div",null,[s[25]||(s[25]=t("p",{class:"info-label"},"过期时间",-1)),t("div",je,[e(a).expirationMode==="activation"&&!e(a).isActivated?(r(),n(tt,{key:0},[s[21]||(s[21]=t("span",{class:"font-medium text-amber-600 dark:text-amber-400"},[t("i",{class:"fas fa-pause-circle mr-1"}),h("未激活 ")],-1)),t("span",Me," (首次使用后 "+i(e(a).activationDays||(e(a).activationUnit==="hours"?24:30))+i(e(a).activationUnit==="hours"?"小时":"天")+"过期) ",1)],64)):e(a).expiresAt?(r(),n(tt,{key:1},[W(e(a).expiresAt)?(r(),n("span",Ie,s[22]||(s[22]=[t("i",{class:"fas fa-exclamation-circle mr-1"},null,-1),h("已过期 ",-1)]))):v(e(a).expiresAt)?(r(),n("span",De,[s[23]||(s[23]=t("i",{class:"fas fa-clock mr-1"},null,-1)),h(i(N(e(a).expiresAt)),1)])):(r(),n("span",qe,i(N(e(a).expiresAt)),1))],64)):(r(),n("span",Ue,s[24]||(s[24]=[t("i",{class:"fas fa-infinity mr-1"},null,-1),h("永不过期 ",-1)])))])])])]))]),t("div",Re,[t("header",Ne,[s[28]||(s[28]=t("div",{class:"header-icon-wrapper bg-green-100 dark:bg-green-900/30"},[t("i",{class:"header-icon fas fa-chart-bar text-green-600 dark:text-green-400"})],-1)),t("div",null,[s[27]||(s[27]=t("h3",{class:"header-title"},"使用统计概览",-1)),t("p",Oe,i(e(x)==="daily"?"今日实时数据":"本月累计数据"),1)]),t("span",Ee,i(e(x)==="daily"?"今日":"本月"),1)]),t("div",Fe,[t("div",We,[s[30]||(s[30]=t("div",{class:"metric-icon-wrapper bg-emerald-50 text-emerald-500 dark:bg-emerald-900/20 dark:text-emerald-400"},[t("i",{class:"fas fa-exchange-alt"})],-1)),t("div",Be,[t("p",Ve,i(u(e(d).requests)),1),s[29]||(s[29]=t("p",{class:"metric-label"},"总请求数",-1))])]),t("div",ze,[s[32]||(s[32]=t("div",{class:"metric-icon-wrapper bg-blue-50 text-blue-500 dark:bg-blue-900/20 dark:text-blue-400"},[t("i",{class:"fas fa-coins"})],-1)),t("div",Je,[t("p",Ye,i(u(e(d).allTokens)),1),s[31]||(s[31]=t("p",{class:"metric-label"},"总Token数",-1))])]),t("div",He,[s[34]||(s[34]=t("div",{class:"metric-icon-wrapper bg-violet-50 text-violet-500 dark:bg-violet-900/20 dark:text-violet-400"},[t("i",{class:"fas fa-dollar-sign"})],-1)),t("div",Ge,[t("p",Qe,i(e(d).formattedCost||"$0.000000"),1),s[33]||(s[33]=t("p",{class:"metric-label"},"预估费用",-1))])]),t("div",Xe,[s[36]||(s[36]=t("div",{class:"metric-icon-wrapper bg-amber-50 text-amber-500 dark:bg-amber-900/20 dark:text-amber-400"},[t("i",{class:"fas fa-arrow-right"})],-1)),t("div",Ze,[t("p",ts,i(u(e(d).inputTokens)),1),s[35]||(s[35]=t("p",{class:"metric-label"},"输入Token",-1))])])])])]),!e(b)&&T.value.length>0?(r(),n("div",es,[s[41]||(s[41]=nt('<header class="section-header" data-v-9619bb90><div class="header-icon-wrapper bg-indigo-100 dark:bg-indigo-900/30" data-v-9619bb90><i class="header-icon fas fa-plug text-indigo-600 dark:text-indigo-400" data-v-9619bb90></i></div><div data-v-9619bb90><h3 class="header-title" data-v-9619bb90>专属账号运行状态</h3><p class="header-subtitle" data-v-9619bb90>实时绑定的后端账号状态</p></div><span class="header-tag ml-auto" data-v-9619bb90><span class="mr-1 inline-block h-2 w-2 animate-pulse rounded-full bg-green-500" data-v-9619bb90></span> 实时更新 </span></header>',1)),t("div",{class:K(["grid grid-cols-1 gap-4 md:gap-6",O.value])},[(r(!0),n(tt,null,et(T.value,g=>{var S,U,f,k,L,F;return r(),n("div",{key:g.id||g.key,class:"account-card group"},[t("div",ss,[t("div",as,[t("span",{class:K(["account-icon shadow-lg shadow-indigo-500/20",g.platform==="claude"?"icon-claude":"icon-openai"])},[t("i",{class:K(g.platform==="claude"?"fas fa-meteor":"fas fa-robot")},null,2)],2),t("div",null,[t("p",ls,i(B(g)),1),t("p",rs,i(g.platform==="claude"?"会话窗口":"额度窗口"),1)])]),E(g.rateLimitStatus)?(r(),n("div",{key:0,class:K(["rate-badge",E(g.rateLimitStatus).class])},[s[37]||(s[37]=t("i",{class:"fas fa-tachometer-alt mr-1"},null,-1)),h(" "+i(E(g.rateLimitStatus).text),1)],2)):A("",!0)]),g.platform==="claude"?(r(),n("div",is,[t("div",os,[t("div",ns,[s[38]||(s[38]=t("span",{class:"font-medium text-slate-500 dark:text-slate-400"},"窗口使用率",-1)),t("span",ds,i(Math.min(100,Math.max(0,Math.round(((S=g.sessionWindow)==null?void 0:S.progress)||0))))+"%",1)]),t("div",us,[t("div",{class:K(["progress-bar shadow-sm",$((U=g.sessionWindow)==null?void 0:U.sessionWindowStatus,g)]),style:H({width:`${Math.min(100,Math.max(0,((f=g.sessionWindow)==null?void 0:f.progress)||0))}%`})},null,6)])]),t("div",cs,[t("div",fs,[s[39]||(s[39]=t("i",{class:"far fa-clock"},null,-1)),t("span",null,i(V((k=g.sessionWindow)==null?void 0:k.windowStart,(L=g.sessionWindow)==null?void 0:L.windowEnd)),1)]),((F=g.sessionWindow)==null?void 0:F.remainingTime)>0?(r(),n("span",ms," 剩余 "+i(M(g.sessionWindow.remainingTime)),1)):A("",!0)])])):g.platform==="openai"?(r(),n("div",gs,[g.codexUsage?(r(),n("div",xs,[(r(),n(tt,null,et(["primary","secondary"],I=>{var J,it,dt,ut;return t("div",{key:`${g.key}-${I}`,class:"quota-row"},[t("div",bs,[t("span",{class:K(["quota-tag",I==="primary"?"tag-indigo":"tag-blue"])},i(rt(I)),3),t("span",ps,i(z((J=g.codexUsage)==null?void 0:J[I])),1)]),t("div",vs,[t("div",{class:K(["progress-bar shadow-sm",w((it=g.codexUsage)==null?void 0:it[I])]),style:H({width:Q((dt=g.codexUsage)==null?void 0:dt[I])})},null,6)]),t("div",ys,[s[40]||(s[40]=t("i",{class:"fas fa-history mr-1"},null,-1)),h(" 重置剩余 "+i(Y((ut=g.codexUsage)==null?void 0:ut[I])),1)])])}),64))])):(r(),n("div",ks," 暂无额度使用数据 "))])):A("",!0)])}),128))],2)])):A("",!0)]))}},_s=at(hs,[["__scopeId","data-v-9619bb90"]]),ws={class:"card-section flex h-full flex-col p-4 md:p-6"},$s={class:"mb-6 flex items-center text-lg font-bold text-slate-800 dark:text-slate-100 md:text-xl"},Ss={class:"flex items-center gap-3"},Cs={class:"flex flex-col"},Ts={class:"text-xs font-normal text-slate-500 dark:text-slate-400"},Ks={class:"flex flex-1 flex-col justify-center space-y-4"},As={class:"distribution-item group"},Ps={class:"mb-1 flex items-center justify-between"},Ls={class:"font-mono text-sm font-bold text-slate-800 dark:text-slate-100"},js={class:"h-1.5 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-700/50"},Ms={class:"distribution-item group"},Is={class:"mb-1 flex items-center justify-between"},Ds={class:"font-mono text-sm font-bold text-slate-800 dark:text-slate-100"},qs={class:"h-1.5 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-700/50"},Us={class:"distribution-item group"},Rs={class:"mb-1 flex items-center justify-between"},Ns={class:"font-mono text-sm font-bold text-slate-800 dark:text-slate-100"},Os={class:"h-1.5 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-700/50"},Es={class:"distribution-item group"},Fs={class:"mb-1 flex items-center justify-between"},Ws={class:"font-mono text-sm font-bold text-slate-800 dark:text-slate-100"},Bs={class:"h-1.5 w-full overflow-hidden rounded-full bg-slate-100 dark:bg-slate-700/50"},Vs={class:"mt-6 border-t border-slate-100 pt-4 dark:border-slate-700/50"},zs={class:"flex items-center justify-between"},Js={class:"text-sm font-medium text-slate-500 dark:text-slate-400"},Ys={class:"font-mono text-xl font-bold tracking-tight text-slate-800 dark:text-slate-100"},Hs={__name:"TokenDistribution",setup(R){const y=lt(),{statsPeriod:a,currentPeriodData:x}=st(y),d=m=>!x.value.allTokens||x.value.allTokens===0||!m?0:Math.min(100,m/x.value.allTokens*100),b=m=>(typeof m!="number"&&(m=parseInt(m)||0),m===0?"0":m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toLocaleString());return(m,c)=>(r(),n("div",ws,[t("h3",$s,[t("div",Ss,[c[1]||(c[1]=t("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400"},[t("i",{class:"fas fa-coins text-lg"})],-1)),t("div",Cs,[c[0]||(c[0]=t("span",null,"Token 使用分布",-1)),t("span",Ts,i(e(a)==="daily"?"今日实时数据":"本月累计数据"),1)])])]),t("div",Ks,[t("div",As,[t("div",Ps,[c[2]||(c[2]=t("span",{class:"flex items-center text-sm font-medium text-slate-600 dark:text-slate-400"},[t("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-50 text-emerald-500 dark:bg-emerald-900/20 dark:text-emerald-400"},[t("i",{class:"fas fa-arrow-right"})]),h(" 输入 Token ")],-1)),t("span",Ls,i(b(e(x).inputTokens)),1)]),t("div",js,[t("div",{class:"h-full rounded-full bg-emerald-500",style:H({width:d(e(x).inputTokens)+"%"})},null,4)])]),t("div",Ms,[t("div",Is,[c[3]||(c[3]=t("span",{class:"flex items-center text-sm font-medium text-slate-600 dark:text-slate-400"},[t("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-blue-50 text-blue-500 dark:bg-blue-900/20 dark:text-blue-400"},[t("i",{class:"fas fa-arrow-left"})]),h(" 输出 Token ")],-1)),t("span",Ds,i(b(e(x).outputTokens)),1)]),t("div",qs,[t("div",{class:"h-full rounded-full bg-blue-500",style:H({width:d(e(x).outputTokens)+"%"})},null,4)])]),t("div",Us,[t("div",Rs,[c[4]||(c[4]=t("span",{class:"flex items-center text-sm font-medium text-slate-600 dark:text-slate-400"},[t("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-purple-50 text-purple-500 dark:bg-purple-900/20 dark:text-purple-400"},[t("i",{class:"fas fa-save"})]),h(" 缓存创建 ")],-1)),t("span",Ns,i(b(e(x).cacheCreateTokens)),1)]),t("div",Os,[t("div",{class:"h-full rounded-full bg-purple-500",style:H({width:d(e(x).cacheCreateTokens)+"%"})},null,4)])]),t("div",Es,[t("div",Fs,[c[5]||(c[5]=t("span",{class:"flex items-center text-sm font-medium text-slate-600 dark:text-slate-400"},[t("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-orange-50 text-orange-500 dark:bg-orange-900/20 dark:text-orange-400"},[t("i",{class:"fas fa-download"})]),h(" 缓存读取 ")],-1)),t("span",Ws,i(b(e(x).cacheReadTokens)),1)]),t("div",Bs,[t("div",{class:"h-full rounded-full bg-orange-500",style:H({width:d(e(x).cacheReadTokens)+"%"})},null,4)])])]),t("div",Vs,[t("div",zs,[t("span",Js,i(e(a)==="daily"?"今日":"本月")+"总计 ",1),t("span",Ys,i(b(e(x).allTokens)),1)])])]))}},Gs=at(Hs,[["__scopeId","data-v-9162aec5"]]),Qs={class:"flex h-full flex-col gap-4 md:gap-6"},Xs={class:"card-section flex h-full flex-col p-4 md:p-6"},Zs={class:"mb-6 flex items-center text-lg font-bold text-slate-800 dark:text-slate-100 md:text-xl"},ta={class:"flex items-center gap-3"},ea={key:0,class:"space-y-4"},sa={class:"rounded-2xl border border-blue-100 bg-gradient-to-br from-blue-50 to-indigo-50 p-5 dark:border-blue-800/30 dark:from-blue-900/20 dark:to-indigo-900/20"},aa={class:"mb-4 flex items-center justify-between"},la={class:"rounded-lg bg-white/80 px-2.5 py-1 text-xs font-bold text-blue-600 shadow-sm dark:bg-slate-800/80 dark:text-blue-300"},ra={class:"grid grid-cols-2 gap-4"},ia={class:"rounded-xl bg-white/50 p-2 text-center dark:bg-slate-800/30"},oa={class:"text-2xl font-bold tracking-tight text-slate-800 dark:text-slate-100"},na={class:"rounded-xl bg-white/50 p-2 text-center dark:bg-slate-800/30"},da={class:"text-2xl font-bold tracking-tight text-emerald-600 dark:text-emerald-400"},ua={class:"rounded-2xl border border-purple-100 bg-gradient-to-br from-purple-50 to-pink-50 p-5 dark:border-purple-800/30 dark:from-purple-900/20 dark:to-pink-900/20"},ca={class:"space-y-3"},fa={class:"flex items-center justify-between rounded-lg bg-white/40 p-2 dark:bg-slate-800/20"},ma={class:"font-mono text-sm font-bold text-slate-800 dark:text-slate-100"},ga={class:"flex items-center justify-between rounded-lg bg-white/40 p-2 dark:bg-slate-800/20"},xa={class:"font-mono text-sm font-bold text-slate-800 dark:text-slate-100"},ba={class:"flex items-center justify-between rounded-lg bg-white/40 p-2 dark:bg-slate-800/20"},pa={class:"font-mono text-sm font-bold text-slate-800 dark:text-slate-100"},va={key:0,class:"rounded-2xl border border-red-100 bg-red-50 p-4 text-sm dark:border-red-800/30 dark:bg-red-900/20"},ya={class:"flex items-center gap-3 font-medium text-red-700 dark:text-red-300"},ka={key:1,class:"space-y-6"},ha={class:"limit-item"},_a={class:"mb-3 flex items-center justify-between"},wa={class:"rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-500 dark:bg-slate-800 dark:text-slate-400"},$a={key:0},Sa={key:1,class:"flex items-center gap-1"},Ca={class:"progress-container"},Ta={key:0,class:"progress-track"},Ka={key:1,class:"progress-track"},Aa={class:"limit-item"},Pa={class:"mb-3 flex items-center justify-between"},La={class:"rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-500 dark:bg-slate-800 dark:text-slate-400"},ja={key:0},Ma={key:1,class:"flex items-center gap-1"},Ia={class:"progress-container"},Da={key:0,class:"progress-track"},qa={key:1,class:"progress-track"},Ua={key:0,class:"limit-item"},Ra={class:"mb-3 flex items-center justify-between"},Na={class:"rounded-md bg-slate-100 px-2 py-1 text-xs font-medium text-slate-500 dark:bg-slate-800 dark:text-slate-400"},Oa={class:"progress-container"},Ea={class:"progress-track"},Fa={key:1,class:"limit-item rounded-2xl border border-slate-100 bg-slate-50 p-4 dark:border-slate-700/50 dark:bg-slate-800/30"},Wa={class:"mt-3 flex items-start gap-2 text-xs text-slate-500 dark:text-slate-400"},Ba={key:0},Va={key:1},za={key:2},Ja={class:"space-y-4 pt-2"},Ya={class:"flex items-center justify-between rounded-xl bg-slate-50 p-3 dark:bg-slate-800/30"},Ha={class:"text-sm font-bold text-slate-900 dark:text-slate-100"},Ga={key:0},Qa={key:1,class:"flex items-center gap-1"},Xa={class:"space-y-3 rounded-xl bg-slate-50 p-3 dark:bg-slate-800/30"},Za={class:"flex items-center justify-between"},tl={class:"text-sm font-bold"},el={key:0,class:"text-amber-600 dark:text-amber-400"},sl={key:1,class:"text-emerald-600 dark:text-emerald-400"},al={class:"space-y-3 rounded-xl bg-slate-50 p-3 dark:bg-slate-800/30"},ll={class:"flex items-center justify-between"},rl={class:"text-sm font-bold"},il={key:0,class:"text-amber-600 dark:text-amber-400"},ol={key:1,class:"text-emerald-600 dark:text-emerald-400"},nl={key:0,class:"flex flex-wrap gap-2 border-t border-slate-200 pt-2 dark:border-slate-700"},dl={key:0,class:"card-section p-4 md:p-6"},ul={class:"rounded-xl border border-amber-200 bg-amber-50 p-4 dark:border-amber-800/50 dark:bg-amber-900/20"},cl={class:"space-y-2"},fl={class:"break-all font-mono text-slate-700 dark:text-slate-200"},ml={__name:"LimitConfig",setup(R){const y=lt(),{statsData:a,multiKeyMode:x,aggregatedStats:d,invalidKeys:b}=st(y),m=D(()=>{var l;const u=(l=a.value)==null?void 0:l.restrictions;return u?u.enableModelRestriction===!0&&Array.isArray(u.restrictedModels)&&u.restrictedModels.length>0:!1}),c=D(()=>{var l;const u=(l=a.value)==null?void 0:l.restrictions;return u?u.enableClientRestriction===!0&&Array.isArray(u.allowedClients)&&u.allowedClients.length>0:!1}),_=()=>{if(!a.value.limits.dailyCostLimit||a.value.limits.dailyCostLimit===0)return 0;const u=a.value.limits.currentDailyCost/a.value.limits.dailyCostLimit*100;return Math.min(u,100)},P=()=>{const u=_();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-green-500"},p=()=>{if(!a.value.limits.totalCostLimit||a.value.limits.totalCostLimit===0)return 0;const u=a.value.limits.currentTotalCost/a.value.limits.totalCostLimit*100;return Math.min(u,100)},C=()=>{const u=p();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-blue-500"},N=()=>{if(!a.value.limits.weeklyOpusCostLimit||a.value.limits.weeklyOpusCostLimit===0)return 0;const u=a.value.limits.weeklyOpusCost/a.value.limits.weeklyOpusCostLimit*100;return Math.min(u,100)},W=()=>{const u=N();return u>=100?"bg-red-500":u>=80?"bg-yellow-500":"bg-indigo-500"},v=u=>(typeof u!="number"&&(u=parseInt(u)||0),u===0?"0":u>=1e6?(u/1e6).toFixed(1)+"M":u>=1e3?(u/1e3).toFixed(1)+"K":u.toLocaleString());return(u,l)=>(r(),n("div",Qs,[t("div",Xs,[t("h3",Zs,[t("div",ta,[l[0]||(l[0]=t("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-rose-100 text-rose-600 dark:bg-rose-900/30 dark:text-rose-400"},[t("i",{class:"fas fa-shield-alt text-lg"})],-1)),t("span",null,i(e(x)?"限制配置（聚合查询模式）":"限制配置"),1)])]),e(x)&&e(d)?(r(),n("div",ea,[t("div",sa,[t("div",aa,[l[1]||(l[1]=t("span",{class:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-200"},[t("i",{class:"fas fa-layer-group text-blue-500"}),h(" API Keys 概况 ")],-1)),t("span",la,i(e(d).activeKeys)+"/"+i(e(d).totalKeys),1)]),t("div",ra,[t("div",ia,[t("div",oa,i(e(d).totalKeys),1),l[2]||(l[2]=t("div",{class:"text-[10px] font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400"}," 总计 Keys ",-1))]),t("div",na,[t("div",da,i(e(d).activeKeys),1),l[3]||(l[3]=t("div",{class:"text-[10px] font-medium uppercase tracking-wider text-slate-500 dark:text-slate-400"}," 激活 Keys ",-1))])])]),t("div",ua,[l[7]||(l[7]=t("div",{class:"mb-4 flex items-center"},[t("div",{class:"mr-3 flex h-8 w-8 items-center justify-center rounded-lg bg-white/80 text-purple-500 shadow-sm dark:bg-slate-800/80"},[t("i",{class:"fas fa-chart-pie"})]),t("span",{class:"text-sm font-bold text-slate-700 dark:text-slate-200"},"聚合统计摘要")],-1)),t("div",ca,[t("div",fa,[l[4]||(l[4]=t("span",{class:"flex items-center gap-2 text-xs font-medium text-slate-600 dark:text-slate-400"},[t("i",{class:"fas fa-database text-slate-400"}),h(" 总请求数 ")],-1)),t("span",ma,i(v(e(d).usage.requests)),1)]),t("div",ga,[l[5]||(l[5]=t("span",{class:"flex items-center gap-2 text-xs font-medium text-slate-600 dark:text-slate-400"},[t("i",{class:"fas fa-coins text-yellow-500"}),h(" 总 Tokens ")],-1)),t("span",xa,i(v(e(d).usage.allTokens)),1)]),t("div",ba,[l[6]||(l[6]=t("span",{class:"flex items-center gap-2 text-xs font-medium text-slate-600 dark:text-slate-400"},[t("i",{class:"fas fa-dollar-sign text-emerald-500"}),h(" 总费用 ")],-1)),t("span",pa,i(e(d).usage.formattedCost),1)])])]),e(b)&&e(b).length>0?(r(),n("div",va,[t("div",ya,[l[8]||(l[8]=t("i",{class:"fas fa-exclamation-triangle text-lg"},null,-1)),t("span",null,i(e(b).length)+" 个无效的 API Key",1)])])):A("",!0),l[9]||(l[9]=t("div",{class:"flex items-start gap-3 rounded-xl bg-slate-50 p-4 text-xs leading-relaxed text-slate-500 dark:bg-slate-800/50 dark:text-slate-400"},[t("i",{class:"fas fa-info-circle mt-0.5 flex-shrink-0"}),t("span",null,"每个 API Key 有独立的限制设置，聚合模式下不显示单个限制配置。统计数据仅包含查询成功的 Key。")],-1))])):A("",!0),e(x)?A("",!0):(r(),n("div",ka,[t("div",ha,[t("div",_a,[l[11]||(l[11]=t("span",{class:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-300"},[t("i",{class:"fas fa-calendar-day text-blue-500"}),h(" 每日费用限制 ")],-1)),t("span",wa,[e(a).limits.dailyCostLimit>0?(r(),n("span",$a," $"+i(e(a).limits.currentDailyCost.toFixed(4))+" / $"+i(e(a).limits.dailyCostLimit.toFixed(2)),1)):(r(),n("span",Sa,[h(" $"+i(e(a).limits.currentDailyCost.toFixed(4))+" / ",1),l[10]||(l[10]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),t("div",Ca,[e(a).limits.dailyCostLimit>0?(r(),n("div",Ta,[t("div",{class:K(["progress-bar shadow-sm",P()]),style:H({width:_()+"%"})},null,6)])):(r(),n("div",Ka,l[12]||(l[12]=[t("div",{class:"progress-bar w-0 bg-emerald-500"},null,-1)])))])]),t("div",Aa,[t("div",Pa,[l[14]||(l[14]=t("span",{class:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-300"},[t("i",{class:"fas fa-wallet text-purple-500"}),h(" 总费用限制 ")],-1)),t("span",La,[e(a).limits.totalCostLimit>0?(r(),n("span",ja," $"+i(e(a).limits.currentTotalCost.toFixed(4))+" / $"+i(e(a).limits.totalCostLimit.toFixed(2)),1)):(r(),n("span",Ma,[h(" $"+i(e(a).limits.currentTotalCost.toFixed(4))+" / ",1),l[13]||(l[13]=t("i",{class:"fas fa-infinity"},null,-1))]))])]),t("div",Ia,[e(a).limits.totalCostLimit>0?(r(),n("div",Da,[t("div",{class:K(["progress-bar shadow-sm",C()]),style:H({width:p()+"%"})},null,6)])):(r(),n("div",qa,l[15]||(l[15]=[t("div",{class:"progress-bar w-0 bg-blue-500"},null,-1)])))])]),e(a).limits.weeklyOpusCostLimit>0?(r(),n("div",Ua,[t("div",Ra,[l[16]||(l[16]=t("span",{class:"flex items-center gap-2 text-sm font-bold text-slate-700 dark:text-slate-300"},[t("i",{class:"fas fa-star text-amber-500"}),h(" Opus 周费用限制 ")],-1)),t("span",Na," $"+i(e(a).limits.weeklyOpusCost.toFixed(4))+" / $"+i(e(a).limits.weeklyOpusCostLimit.toFixed(2)),1)]),t("div",Oa,[t("div",Ea,[t("div",{class:K(["progress-bar shadow-sm",W()]),style:H({width:N()+"%"})},null,6)])])])):A("",!0),e(a).limits.rateLimitWindow>0&&(e(a).limits.rateLimitRequests>0||e(a).limits.tokenLimit>0||e(a).limits.rateLimitCost>0)?(r(),n("div",Fa,[Z(At,{"cost-limit":e(a).limits.rateLimitCost,"current-cost":e(a).limits.currentWindowCost,"current-requests":e(a).limits.currentWindowRequests,"current-tokens":e(a).limits.currentWindowTokens,label:"时间窗口限制","rate-limit-window":e(a).limits.rateLimitWindow,"request-limit":e(a).limits.rateLimitRequests,"show-progress":!0,"show-tooltip":!0,"token-limit":e(a).limits.tokenLimit,"window-end-time":e(a).limits.windowEndTime,"window-remaining-seconds":e(a).limits.windowRemainingSeconds,"window-start-time":e(a).limits.windowStartTime},null,8,["cost-limit","current-cost","current-requests","current-tokens","rate-limit-window","request-limit","token-limit","window-end-time","window-remaining-seconds","window-start-time"]),t("div",Wa,[l[17]||(l[17]=t("i",{class:"fas fa-info-circle mt-0.5"},null,-1)),e(a).limits.rateLimitCost>0?(r(),n("span",Ba,' 请求次数和费用限制为"或"的关系，任一达到限制即触发限流 ')):e(a).limits.tokenLimit>0?(r(),n("span",Va,' 请求次数和Token使用量为"或"的关系，任一达到限制即触发限流 ')):(r(),n("span",za," 仅限制请求次数 "))])])):A("",!0),t("div",Ja,[t("div",Ya,[l[19]||(l[19]=t("span",{class:"text-sm font-medium text-slate-600 dark:text-slate-400"},"并发限制",-1)),t("span",Ha,[e(a).limits.concurrencyLimit>0?(r(),n("span",Ga,i(e(a).limits.concurrencyLimit),1)):(r(),n("span",Qa,l[18]||(l[18]=[t("i",{class:"fas fa-infinity text-slate-400"},null,-1)])))])]),t("div",Xa,[t("div",Za,[l[22]||(l[22]=t("span",{class:"text-sm font-medium text-slate-600 dark:text-slate-400"},"模型限制",-1)),t("span",tl,[m.value?(r(),n("span",el,[l[20]||(l[20]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs"},null,-1)),h(" 限制 "+i(e(a).restrictions.restrictedModels.length)+" 个模型 ",1)])):(r(),n("span",sl,l[21]||(l[21]=[t("i",{class:"fas fa-check-circle mr-1 text-xs"},null,-1),h(" 允许所有 ",-1)])))])])]),t("div",al,[t("div",ll,[l[25]||(l[25]=t("span",{class:"text-sm font-medium text-slate-600 dark:text-slate-400"},"客户端限制",-1)),t("span",rl,[c.value?(r(),n("span",il,[l[23]||(l[23]=t("i",{class:"fas fa-exclamation-triangle mr-1 text-xs"},null,-1)),h(" 限 "+i(e(a).restrictions.allowedClients.length)+" 种客户端 ",1)])):(r(),n("span",ol,l[24]||(l[24]=[t("i",{class:"fas fa-check-circle mr-1 text-xs"},null,-1),h(" 允许所有 ",-1)])))])]),c.value?(r(),n("div",nl,[(r(!0),n(tt,null,et(e(a).restrictions.allowedClients,T=>(r(),n("span",{key:T,class:"flex items-center gap-1 rounded-lg border border-blue-100 bg-white px-2 py-1 text-xs font-medium text-blue-600 shadow-sm dark:border-slate-700 dark:bg-slate-900 dark:text-blue-300"},[l[26]||(l[26]=t("i",{class:"fas fa-id-badge"},null,-1)),h(" "+i(T),1)]))),128))])):A("",!0)])])]))]),m.value?(r(),n("div",dl,[l[30]||(l[30]=t("h3",{class:"mb-4 flex items-center text-lg font-bold text-slate-900 dark:text-slate-100 md:text-xl"},[t("i",{class:"fas fa-list-alt mr-2 text-sm text-amber-500 md:mr-3 md:text-base"}),h(" 详细限制信息 ")],-1)),t("div",ul,[l[28]||(l[28]=t("h4",{class:"mb-3 flex items-center text-sm font-bold text-amber-800 dark:text-amber-300"},[t("i",{class:"fas fa-robot mr-2"}),h(" 受限模型列表 ")],-1)),t("div",cl,[(r(!0),n(tt,null,et(e(a).restrictions.restrictedModels,T=>(r(),n("div",{key:T,class:"flex items-center gap-2 rounded-lg border border-amber-100 bg-white px-3 py-2 text-xs shadow-sm dark:border-amber-700/50 dark:bg-slate-800 md:text-sm"},[l[27]||(l[27]=t("i",{class:"fas fa-ban text-red-500"},null,-1)),t("span",fl,i(T),1)]))),128))]),l[29]||(l[29]=t("p",{class:"mt-3 text-xs font-medium text-amber-700 dark:text-amber-400"},[t("i",{class:"fas fa-info-circle mr-1"}),h(" 此 API Key 不能访问以上列出的模型 ")],-1))])])):A("",!0)]))}},gl=at(ml,[["__scopeId","data-v-fe8cf351"]]),xl={class:"card-section flex h-full flex-col p-4 md:p-6"},bl={class:"mb-6 flex items-center text-lg font-bold text-slate-800 dark:text-slate-100 md:text-xl"},pl={class:"flex items-center gap-3"},vl={class:"flex flex-col"},yl={class:"text-xs font-normal text-slate-500 dark:text-slate-400"},kl={key:0,class:"flex-1 space-y-4"},hl={class:"mb-2 flex items-center justify-between text-sm"},_l={class:"flex items-center gap-2 truncate font-bold text-slate-700 dark:text-slate-200"},wl={class:"font-mono text-xs font-bold text-slate-600 dark:text-slate-300"},$l={class:"progress-track"},Sl={class:"mt-1.5 flex items-center justify-between font-mono text-[10px] text-slate-400 dark:text-slate-500"},Cl={key:0,class:"mt-4 border-t border-slate-100 pt-4 dark:border-slate-700/50"},Tl={class:"flex items-center justify-between text-sm text-slate-500 dark:text-slate-400"},Kl={class:"flex items-center gap-2"},Al={class:"font-mono font-bold"},Pl={key:1,class:"flex flex-1 flex-col items-center justify-center py-8 text-sm text-slate-400 dark:text-slate-500"},Ll={key:2,class:"flex flex-1 flex-col items-center justify-center py-8 text-sm text-slate-400 dark:text-slate-500"},jl={__name:"AggregatedStatsCard",setup(R){const y=lt(),{aggregatedStats:a,individualStats:x,statsPeriod:d,multiKeyMode:b}=st(y),m=v=>v?d.value==="daily"?v.dailyUsage||v.usage:v.monthlyUsage||v.usage:null,c=D(()=>!x.value||x.value.length===0?[]:[...x.value].sort((v,u)=>{const l=m(v),T=m(u);return((T==null?void 0:T.cost)||0)-((l==null?void 0:l.cost)||0)}).slice(0,5)),_=D(()=>x.value?Math.max(0,x.value.length-5):0),P=D(()=>{var T,O;if(!x.value||!a.value)return 0;const v=c.value.reduce((B,G)=>{const E=m(G);return B+((E==null?void 0:E.cost)||0)},0),u=d.value==="daily"?((T=a.value.dailyUsage)==null?void 0:T.cost)||0:((O=a.value.monthlyUsage)==null?void 0:O.cost)||0;if(u===0)return 0;const l=u-v;return Math.max(0,Math.round(l/u*100))}),p=v=>{var O,B;if(!a.value)return 0;const u=d.value==="daily"?((O=a.value.dailyUsage)==null?void 0:O.cost)||0:((B=a.value.monthlyUsage)==null?void 0:B.cost)||0;if(u===0)return 0;const l=m(v),T=((l==null?void 0:l.cost)||0)/u*100;return Math.round(T)},C=v=>["bg-blue-500","bg-emerald-500","bg-purple-500","bg-amber-500","bg-rose-500"][v]||"bg-slate-400",N=v=>["bg-blue-500","bg-emerald-500","bg-purple-500","bg-amber-500","bg-rose-500"][v]||"bg-slate-400",W=v=>(typeof v!="number"&&(v=parseInt(v)||0),v===0?"0":v>=1e6?(v/1e6).toFixed(1)+"M":v>=1e3?(v/1e3).toFixed(1)+"K":v.toLocaleString());return(v,u)=>(r(),n("div",xl,[t("h3",bl,[t("div",pl,[u[1]||(u[1]=t("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-orange-100 text-orange-600 dark:bg-orange-900/30 dark:text-orange-400"},[t("i",{class:"fas fa-chart-pie text-lg"})],-1)),t("div",vl,[u[0]||(u[0]=t("span",null,"使用占比",-1)),t("span",yl,i(e(d)==="daily"?"今日实时数据":"本月累计数据"),1)])])]),e(a)&&e(x).length>0?(r(),n("div",kl,[(r(!0),n(tt,null,et(c.value,(l,T)=>{var O,B;return r(),n("div",{key:l.apiId,class:"usage-item group"},[t("div",hl,[t("span",_l,[t("span",{class:K(["flex h-5 w-5 items-center justify-center rounded-full font-mono text-xs text-white",N(T)])},i(T+1),3),h(" "+i(l.name||`Key ${T+1}`),1)]),t("span",wl,i(p(l))+"% ",1)]),t("div",$l,[t("div",{class:K(["progress-bar",C(T)]),style:H({width:p(l)+"%"})},null,6)]),t("div",Sl,[t("span",null,[u[2]||(u[2]=t("i",{class:"fas fa-exchange-alt mr-1"},null,-1)),h(i(W(((O=m(l))==null?void 0:O.requests)||0)),1)]),t("span",null,[u[3]||(u[3]=t("i",{class:"fas fa-dollar-sign mr-1"},null,-1)),h(i(((B=m(l))==null?void 0:B.formattedCost)||"$0.00"),1)])])])}),128)),_.value>0?(r(),n("div",Cl,[t("div",Tl,[t("span",Kl,[u[4]||(u[4]=t("span",{class:"flex h-5 w-5 items-center justify-center rounded-full bg-slate-200 text-[10px] dark:bg-slate-700"},[t("i",{class:"fas fa-ellipsis-h"})],-1)),h(" 其他 "+i(_.value)+" 个Keys ",1)]),t("span",Al,i(P.value)+"%",1)])])):A("",!0)])):e(b)?(r(),n("div",Ll,u[6]||(u[6]=[t("div",{class:"mb-3 flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 dark:bg-slate-800/50"},[t("i",{class:"fas fa-inbox text-2xl"})],-1),h(" 暂无数据 ",-1)]))):(r(),n("div",Pl,u[5]||(u[5]=[t("div",{class:"mb-3 flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 dark:bg-slate-800/50"},[t("i",{class:"fas fa-chart-pie text-2xl"})],-1),t("p",null,"使用占比仅在多Key查询时显示",-1)])))]))}},Ml=at(jl,[["__scopeId","data-v-ff9804d1"]]),Il={class:"card-section p-4 md:p-6"},Dl={class:"mb-6 flex items-center justify-between"},ql={class:"flex flex-col text-lg font-bold text-slate-800 dark:text-slate-100 sm:flex-row sm:items-center md:text-xl"},Ul={class:"flex items-center gap-3"},Rl={class:"block text-xs font-normal text-slate-500 dark:text-slate-400"},Nl={class:"rounded-lg bg-slate-100 px-3 py-1.5 text-xs font-medium text-slate-600 dark:bg-slate-800 dark:text-slate-300"},Ol={key:0,class:"flex flex-col items-center justify-center py-12 text-center"},El={key:1,class:"grid gap-4 sm:grid-cols-1 lg:grid-cols-2"},Fl={class:"mb-4 flex items-start justify-between gap-4 border-b border-slate-100 pb-4 dark:border-slate-700/50"},Wl={class:"min-w-0 flex-1"},Bl={class:"flex items-center gap-2"},Vl={class:"break-all font-mono text-sm font-bold text-slate-800 dark:text-slate-100 md:text-base"},zl={class:"mt-1 pl-8 text-xs text-slate-500 dark:text-slate-400"},Jl={class:"flex-shrink-0 text-right"},Yl={class:"font-mono text-lg font-bold text-emerald-600 dark:text-emerald-400"},Hl={class:"grid grid-cols-2 gap-3"},Gl={class:"stat-mini-card bg-amber-50/50 dark:bg-amber-900/10"},Ql={class:"mt-1 font-mono text-sm font-semibold text-slate-700 dark:text-slate-200"},Xl={class:"stat-mini-card bg-blue-50/50 dark:bg-blue-900/10"},Zl={class:"mt-1 font-mono text-sm font-semibold text-slate-700 dark:text-slate-200"},tr={class:"stat-mini-card bg-purple-50/50 dark:bg-purple-900/10"},er={class:"mt-1 font-mono text-sm font-semibold text-slate-700 dark:text-slate-200"},sr={class:"stat-mini-card bg-emerald-50/50 dark:bg-emerald-900/10"},ar={class:"mt-1 font-mono text-sm font-semibold text-slate-700 dark:text-slate-200"},lr={key:2,class:"flex flex-col items-center justify-center py-12 text-center text-slate-400 dark:text-slate-500"},rr={class:"text-sm font-medium md:text-base"},ir={__name:"ModelUsageStats",setup(R){const y=lt(),{statsPeriod:a,modelStats:x,modelStatsLoading:d}=st(y),b=m=>(typeof m!="number"&&(m=parseInt(m)||0),m===0?"0":m>=1e6?(m/1e6).toFixed(1)+"M":m>=1e3?(m/1e3).toFixed(1)+"K":m.toLocaleString());return(m,c)=>(r(),n("div",Il,[t("div",Dl,[t("h3",ql,[t("div",Ul,[c[1]||(c[1]=t("div",{class:"flex h-10 w-10 items-center justify-center rounded-xl bg-indigo-100 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400"},[t("i",{class:"fas fa-robot text-lg"})],-1)),t("div",null,[c[0]||(c[0]=t("span",{class:"block"},"模型使用统计",-1)),t("span",Rl,i(e(a)==="daily"?"今日实时数据":"本月累计数据"),1)])])]),t("div",Nl," 共 "+i(e(x).length)+" 个模型 ",1)]),e(d)?(r(),n("div",Ol,c[2]||(c[2]=[nt('<div class="relative mb-4" data-v-56816438><div class="absolute inset-0 animate-ping rounded-full bg-indigo-400 opacity-20" data-v-56816438></div><div class="relative flex h-12 w-12 items-center justify-center rounded-full bg-indigo-100 text-indigo-600 dark:bg-indigo-900/30 dark:text-indigo-400" data-v-56816438><i class="fas fa-spinner fa-spin text-xl" data-v-56816438></i></div></div><p class="text-sm font-medium text-slate-600 dark:text-slate-300" data-v-56816438>正在加载模型统计数据...</p>',2)]))):e(x).length>0?(r(),n("div",El,[(r(!0),n(tt,null,et(e(x),(_,P)=>{var p;return r(),n("div",{key:P,class:"model-card group"},[t("div",Fl,[t("div",Wl,[t("div",Bl,[c[3]||(c[3]=t("span",{class:"inline-flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-md bg-slate-100 text-xs text-slate-500 dark:bg-slate-800 dark:text-slate-400"},[t("i",{class:"fas fa-cube"})],-1)),t("h4",Vl,i(_.model),1)]),t("p",zl,[c[4]||(c[4]=t("i",{class:"fas fa-exchange-alt mr-1 text-[10px]"},null,-1)),h(" "+i(b(_.requests))+" 次请求 ",1)])]),t("div",Jl,[t("div",Yl,i(((p=_.formatted)==null?void 0:p.total)||"$0.000000"),1),c[5]||(c[5]=t("div",{class:"text-[10px] font-medium uppercase tracking-wider text-slate-400"}," 总费用 ",-1))])]),t("div",Hl,[t("div",Gl,[c[6]||(c[6]=t("div",{class:"text-[10px] font-medium uppercase tracking-wider text-amber-600/70 dark:text-amber-400/70"}," 输入 Token ",-1)),t("div",Ql,i(b(_.inputTokens)),1)]),t("div",Xl,[c[7]||(c[7]=t("div",{class:"text-[10px] font-medium uppercase tracking-wider text-blue-600/70 dark:text-blue-400/70"}," 输出 Token ",-1)),t("div",Zl,i(b(_.outputTokens)),1)]),t("div",tr,[c[8]||(c[8]=t("div",{class:"text-[10px] font-medium uppercase tracking-wider text-purple-600/70 dark:text-purple-400/70"}," 缓存创建 ",-1)),t("div",er,i(b(_.cacheCreateTokens)),1)]),t("div",sr,[c[9]||(c[9]=t("div",{class:"text-[10px] font-medium uppercase tracking-wider text-emerald-600/70 dark:text-emerald-400/70"}," 缓存读取 ",-1)),t("div",ar,i(b(_.cacheReadTokens)),1)])])])}),128))])):(r(),n("div",lr,[c[10]||(c[10]=t("div",{class:"mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-slate-50 text-3xl dark:bg-slate-800/50"},[t("i",{class:"fas fa-chart-pie"})],-1)),t("p",rr," 暂无"+i(e(a)==="daily"?"今日":"本月")+"模型使用数据 ",1)]))]))}},or=at(ir,[["__scopeId","data-v-56816438"]]),nr={key:0,class:"fixed inset-0 z-[1050] flex items-center justify-center bg-gray-900/40 backdrop-blur-sm"},dr={class:"relative z-10 mx-3 flex w-full max-w-lg flex-col overflow-hidden rounded-2xl border border-gray-200/70 bg-white/95 shadow-2xl ring-1 ring-black/5 transition-all dark:border-gray-700/60 dark:bg-gray-900/95 dark:ring-white/10 sm:mx-4"},ur={class:"flex items-center justify-between border-b border-gray-100 bg-white/80 px-5 py-4 backdrop-blur dark:border-gray-800 dark:bg-gray-900/80"},cr={class:"flex items-center gap-3"},fr={class:"text-xs text-gray-500 dark:text-gray-400"},mr=["disabled"],gr={class:"max-h-[70vh] overflow-y-auto px-5 py-4"},xr={class:"mb-4"},br={class:"relative"},pr=["value"],vr={class:"mb-4 space-y-2"},yr={class:"flex items-center justify-between text-sm"},kr={class:"font-medium text-gray-700 dark:text-gray-300"},hr={class:"flex items-center gap-3"},_r={class:"text-xs text-gray-500 dark:text-gray-400"},wr={key:0,class:"mb-4 overflow-hidden rounded-xl border border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"},$r={class:"flex items-center justify-between border-b border-gray-200 bg-gray-100 px-3 py-2 dark:border-gray-700 dark:bg-gray-800"},Sr={key:0,class:"text-xs text-gray-500 dark:text-gray-500"},Cr={class:"max-h-40 overflow-y-auto p-3"},Tr={key:0,class:"whitespace-pre-wrap text-sm text-gray-700 dark:text-gray-300"},Kr={key:0,class:"inline-block h-4 w-1 animate-pulse bg-blue-500"},Ar={key:1,class:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400"},Pr={key:2,class:"text-sm text-red-600 dark:text-red-400"},Lr={key:1,class:"mb-4 flex items-center justify-center gap-2 text-xs text-gray-500 dark:text-gray-400"},jr={class:"flex items-center justify-end gap-3 border-t border-gray-100 bg-gray-50/80 px-5 py-3 dark:border-gray-800 dark:bg-gray-900/50"},Mr=["disabled"],Ir=["disabled"],Dr={__name:"ApiKeyTestModal",props:{show:{type:Boolean,default:!1},apiKeyValue:{type:String,default:""},apiKeyName:{type:String,default:""}},emits:["close"],setup(R,{emit:y}){const a=R,x=y,d=j("idle"),b=j(""),m=j(""),c=j(0),_=j(null),P=j(null),p=j("claude-sonnet-4-5-20250929"),C=D(()=>a.apiKeyName||"当前 API Key"),N=D(()=>{const M=a.apiKeyValue;return M?M.length<=10?"****":M.substring(0,6)+"****"+M.substring(M.length-4):""}),W=D(()=>{switch(d.value){case"idle":return"准备就绪";case"testing":return"正在测试...";case"success":return"测试成功";case"error":return"测试失败";default:return"未知状态"}}),v=D(()=>{switch(d.value){case"idle":return"点击下方按钮开始测试 API Key 连通性";case"testing":return"正在通过 /api 端点发送测试请求";case"success":return"API Key 可以正常访问服务";case"error":return m.value||"无法通过 API Key 访问服务";default:return""}}),u=D(()=>{switch(d.value){case"idle":return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50";case"testing":return"border-blue-200 bg-blue-50 dark:border-blue-500/30 dark:bg-blue-900/20";case"success":return"border-green-200 bg-green-50 dark:border-green-500/30 dark:bg-green-900/20";case"error":return"border-red-200 bg-red-50 dark:border-red-500/30 dark:bg-red-900/20";default:return"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800/50"}}),l=D(()=>{switch(d.value){case"idle":return"bg-gray-200 dark:bg-gray-700";case"testing":return"bg-blue-100 dark:bg-blue-500/30";case"success":return"bg-green-100 dark:bg-green-500/30";case"error":return"bg-red-100 dark:bg-red-500/30";default:return"bg-gray-200 dark:bg-gray-700"}}),T=D(()=>{switch(d.value){case"idle":return"fa-hourglass-start";case"testing":return"fa-spinner fa-spin";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";default:return"fa-question-circle"}}),O=D(()=>{switch(d.value){case"idle":return"text-gray-500 dark:text-gray-400";case"testing":return"text-blue-500 dark:text-blue-400";case"success":return"text-green-500 dark:text-green-400";case"error":return"text-red-500 dark:text-red-400";default:return"text-gray-500 dark:text-gray-400"}}),B=D(()=>{switch(d.value){case"idle":return"text-gray-700 dark:text-gray-300";case"testing":return"text-blue-700 dark:text-blue-300";case"success":return"text-green-700 dark:text-green-300";case"error":return"text-red-700 dark:text-red-300";default:return"text-gray-700 dark:text-gray-300"}});async function G(){if(!a.apiKeyValue)return;d.value="testing",b.value="",m.value="",c.value=0,_.value=Date.now(),P.value&&P.value.abort(),P.value=new AbortController;const M=`${$t}/apiStats/api-key/test`;try{const $=await fetch(M,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:a.apiKeyValue,model:p.value}),signal:P.value.signal});if(!$.ok){const z=await $.json().catch(()=>({}));throw new Error(z.message||z.error||`HTTP ${$.status}`)}const q=$.body.getReader(),w=new TextDecoder;let Q=!1;for(;!Q;){const{done:z,value:Y}=await q.read();if(z){Q=!0;continue}const o=w.decode(Y).split(`
`);for(const s of o)if(s.startsWith("data: "))try{const g=JSON.parse(s.substring(6));E(g)}catch{}}}catch($){if($.name==="AbortError")return;d.value="error",m.value=$.message||"连接失败",c.value=Date.now()-_.value}}function E(M){switch(M.type){case"test_start":break;case"content":b.value+=M.text;break;case"message_stop":break;case"test_complete":c.value=Date.now()-_.value,M.success?d.value="success":(d.value="error",m.value=M.error||"测试失败");break;case"error":d.value="error",m.value=M.error||"未知错误",c.value=Date.now()-_.value;break}}function V(){d.value!=="testing"&&(P.value&&(P.value.abort(),P.value=null),d.value="idle",b.value="",m.value="",c.value=0,x("close"))}return bt(()=>a.show,M=>{M&&(d.value="idle",b.value="",m.value="",c.value=0)}),pt(()=>{P.value&&P.value.abort()}),(M,$)=>(r(),ot(kt,{to:"body"},[R.show?(r(),n("div",nr,[t("div",{class:"absolute inset-0",onClick:V}),t("div",dr,[t("div",ur,[t("div",cr,[t("div",{class:K(["flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl text-white shadow-lg",d.value==="success"?"bg-gradient-to-br from-green-500 to-emerald-500":d.value==="error"?"bg-gradient-to-br from-red-500 to-pink-500":"bg-gradient-to-br from-blue-500 to-indigo-500"])},[t("i",{class:K(["fas",d.value==="idle"?"fa-vial":d.value==="testing"?"fa-spinner fa-spin":d.value==="success"?"fa-check":"fa-times"])},null,2)],2),t("div",null,[$[0]||($[0]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"}," API Key 端点测试 ",-1)),t("p",fr,i(C.value),1)])]),t("button",{class:"flex h-9 w-9 items-center justify-center rounded-full bg-gray-100 text-gray-500 transition hover:bg-gray-200 hover:text-gray-700 dark:bg-gray-800 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-gray-200",disabled:d.value==="testing",onClick:V},$[1]||($[1]=[t("i",{class:"fas fa-times text-sm"},null,-1)]),8,mr)]),t("div",gr,[t("div",xr,[$[3]||($[3]=t("label",{class:"mb-2 block text-sm font-medium text-gray-700 dark:text-gray-300"}," API Key ",-1)),t("div",br,[t("input",{class:"w-full rounded-lg border border-gray-200 bg-gray-50 px-3 py-2 pr-10 text-sm text-gray-700 dark:border-gray-600 dark:bg-gray-800 dark:text-gray-200",readonly:"",type:"text",value:N.value},null,8,pr),$[2]||($[2]=t("div",{class:"absolute right-2 top-1/2 -translate-y-1/2 text-gray-400"},[t("i",{class:"fas fa-lock text-xs"})],-1))]),$[4]||($[4]=t("p",{class:"mt-1 text-xs text-gray-500 dark:text-gray-400"}," 测试将使用此 API Key 调用当前服务的 /api 端点 ",-1))]),t("div",vr,[$[6]||($[6]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"测试端点"),t("span",{class:"inline-flex items-center gap-1.5 rounded-full bg-blue-100 px-2.5 py-0.5 text-xs font-medium text-blue-700 dark:bg-blue-500/20 dark:text-blue-300"},[t("i",{class:"fas fa-link"}),h(" /api/v1/messages ")])],-1)),t("div",yr,[$[5]||($[5]=t("span",{class:"text-gray-500 dark:text-gray-400"},"测试模型",-1)),t("span",kr,i(p.value),1)]),$[7]||($[7]=t("div",{class:"flex items-center justify-between text-sm"},[t("span",{class:"text-gray-500 dark:text-gray-400"},"模拟客户端"),t("span",{class:"font-medium text-gray-700 dark:text-gray-300"},"Claude Code")],-1))]),t("div",{class:K(["mb-4 rounded-xl border p-4 transition-all duration-300",u.value])},[t("div",hr,[t("div",{class:K(["flex h-8 w-8 items-center justify-center rounded-lg",l.value])},[t("i",{class:K(["fas text-sm",T.value,O.value])},null,2)],2),t("div",null,[t("p",{class:K(["font-medium",B.value])},i(W.value),3),t("p",_r,i(v.value),1)])])],2),d.value!=="idle"?(r(),n("div",wr,[t("div",$r,[$[8]||($[8]=t("span",{class:"text-xs font-medium text-gray-600 dark:text-gray-400"},"AI 响应",-1)),b.value?(r(),n("span",Sr,i(b.value.length)+" 字符 ",1)):A("",!0)]),t("div",Cr,[b.value?(r(),n("p",Tr,[h(i(b.value)+" ",1),d.value==="testing"?(r(),n("span",Kr)):A("",!0)])):d.value==="testing"?(r(),n("p",Ar,$[9]||($[9]=[t("i",{class:"fas fa-circle-notch fa-spin"},null,-1),h(" 等待响应中... ",-1)]))):d.value==="error"&&m.value?(r(),n("p",Pr,i(m.value),1)):A("",!0)])])):A("",!0),c.value>0?(r(),n("div",Lr,[$[10]||($[10]=t("i",{class:"fas fa-clock"},null,-1)),t("span",null,"耗时 "+i((c.value/1e3).toFixed(2))+" 秒",1)])):A("",!0)]),t("div",jr,[t("button",{class:"rounded-lg border border-gray-200 bg-white px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:bg-gray-50 hover:shadow dark:border-gray-700 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700",disabled:d.value==="testing",onClick:V}," 关闭 ",8,Mr),t("button",{class:K(["flex items-center gap-2 rounded-lg px-4 py-2 text-sm font-medium shadow-sm transition",d.value==="testing"||!R.apiKeyValue?"cursor-not-allowed bg-gray-200 text-gray-400 dark:bg-gray-700 dark:text-gray-500":"bg-gradient-to-r from-blue-500 to-indigo-500 text-white hover:from-blue-600 hover:to-indigo-600 hover:shadow-md"]),disabled:d.value==="testing"||!R.apiKeyValue,onClick:G},[t("i",{class:K(["fas",d.value==="testing"?"fa-spinner fa-spin":"fa-play"])},null,2),h(" "+i(d.value==="testing"?"测试中...":d.value==="idle"?"开始测试":"重新测试"),1)],10,Ir)])])])):A("",!0)]))}},qr={class:"glass-nav mb-6 rounded-3xl p-4 shadow-lg md:mb-8 md:p-5"},Ur={class:"flex flex-col items-center justify-between gap-4 md:flex-row"},Rr={class:"flex items-center gap-2 md:gap-4"},Nr={class:"flex items-center"},Or={key:0,class:"h-8 w-px bg-gradient-to-b from-transparent via-gray-300 to-transparent opacity-50 dark:via-gray-600"},Er={class:"mb-6 md:mb-8"},Fr={class:"flex justify-center"},Wr={class:"inline-flex w-full max-w-md rounded-full border border-white/20 bg-white/10 p-1 shadow-lg backdrop-blur-xl md:w-auto"},Br={key:0,class:"tab-content"},Vr={key:0,class:"animate-shake mb-6 md:mb-8"},zr={class:"flex items-center rounded-2xl border border-red-500/30 bg-red-500/10 p-4 text-sm text-red-800 shadow-lg backdrop-blur-sm dark:border-red-500/20 dark:bg-red-500/20 dark:text-red-200 md:text-base"},Jr={key:1,class:"fade-in space-y-6"},Yr={class:"toolbar-card flex flex-col items-center justify-between gap-4 rounded-3xl border border-white/20 bg-white/80 p-4 shadow-lg backdrop-blur-xl dark:border-white/10 dark:bg-slate-900/80 md:flex-row"},Hr={class:"flex w-full items-center gap-2 rounded-xl bg-slate-100 p-1 dark:bg-slate-800/50 md:w-auto"},Gr=["disabled"],Qr=["disabled"],Xr=["disabled"],Zr={class:"grid grid-cols-1 gap-4 md:gap-6 xl:grid-cols-2 xl:items-stretch"},ti={key:0,class:"fixed bottom-6 right-6 z-50 md:hidden"},ei={key:1,class:"tab-content"},si={class:"glass-strong overflow-hidden rounded-3xl shadow-xl"},ai={__name:"ApiStatsView",setup(R){const y=_t(),a=lt(),x=St(),d=j("stats"),b=D(()=>x.isDarkMode),{apiKey:m,apiId:c,loading:_,modelStatsLoading:P,oemLoading:p,error:C,statsPeriod:N,statsData:W,oemSettings:v,multiKeyMode:u}=st(a),{queryStats:l,switchPeriod:T,loadStatsWithApiId:O,loadOemSettings:B,reset:G}=a,E=j(!1),V=()=>{E.value=!0},M=()=>{E.value=!1},$=q=>{(q.ctrlKey||q.metaKey)&&q.key==="Enter"&&(!_.value&&m.value.trim()&&l(),q.preventDefault()),q.key==="Escape"&&G()};return ht(()=>{x.initTheme(),B();const q=y.query.apiId,w=y.query.apiKey;q&&q.match(/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/i)?(c.value=q,O()):w&&w.length>10&&(m.value=w),document.addEventListener("keydown",$)}),pt(()=>{document.removeEventListener("keydown",$)}),bt(m,q=>{q||a.clearData()}),(q,w)=>{var z;const Q=wt("router-link");return r(),n("div",{class:K(["min-h-screen p-4 md:p-6",b.value?"gradient-bg-dark":"gradient-bg"])},[t("div",qr,[t("div",Ur,[Z(Ct,{loading:e(p),"logo-src":e(v).siteIconData||e(v).siteIcon,subtitle:d.value==="stats"?"API Key 使用统计":"使用教程",title:e(v).siteName},null,8,["loading","logo-src","subtitle","title"]),t("div",Rr,[t("div",Nr,[Z(Tt,{mode:"dropdown"})]),e(v).ldapEnabled||e(v).showAdminButton!==!1?(r(),n("div",Or)):A("",!0),e(v).ldapEnabled?(r(),ot(Q,{key:1,class:"user-login-button flex items-center gap-2 rounded-2xl px-4 py-2 text-white transition-all duration-300 md:px-5 md:py-2.5",to:"/user-login"},{default:xt(()=>w[4]||(w[4]=[t("i",{class:"fas fa-user text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"用户登录",-1)])),_:1,__:[4]})):A("",!0),e(v).showAdminButton!==!1?(r(),ot(Q,{key:2,class:"admin-button-refined flex items-center gap-2 rounded-2xl px-4 py-2 transition-all duration-300 md:px-5 md:py-2.5",to:"/dashboard"},{default:xt(()=>w[5]||(w[5]=[t("i",{class:"fas fa-shield-alt text-sm md:text-base"},null,-1),t("span",{class:"text-xs font-semibold tracking-wide md:text-sm"},"管理后台",-1)])),_:1,__:[5]})):A("",!0)])])]),t("div",Er,[t("div",Fr,[t("div",Wr,[t("button",{class:K(["tab-pill-button",d.value==="stats"?"active":""]),onClick:w[0]||(w[0]=Y=>d.value="stats")},w[6]||(w[6]=[t("i",{class:"fas fa-chart-line mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"统计查询",-1)]),2),t("button",{class:K(["tab-pill-button",d.value==="tutorial"?"active":""]),onClick:w[1]||(w[1]=Y=>d.value="tutorial")},w[7]||(w[7]=[t("i",{class:"fas fa-graduation-cap mr-1 md:mr-2"},null,-1),t("span",{class:"text-sm md:text-base"},"使用教程",-1)]),2)])])]),d.value==="stats"?(r(),n("div",Br,[Z(Qt),e(C)?(r(),n("div",Vr,[t("div",zr,[w[9]||(w[9]=t("div",{class:"mr-3 flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-full bg-red-100 text-red-500 dark:bg-red-900/30"},[t("i",{class:"fas fa-exclamation-triangle"})],-1)),t("div",null,[w[8]||(w[8]=t("p",{class:"font-bold"},"查询出错",-1)),t("p",null,i(e(C)),1)])])])):A("",!0),e(W)?(r(),n("div",Jr,[t("div",Yr,[w[13]||(w[13]=nt('<div class="flex items-center gap-3" data-v-6927b0a2><div class="flex h-10 w-10 items-center justify-center rounded-xl bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400" data-v-6927b0a2><i class="fas fa-clock text-lg" data-v-6927b0a2></i></div><div data-v-6927b0a2><span class="block text-sm font-bold text-slate-800 dark:text-slate-100" data-v-6927b0a2>统计时间范围</span><span class="block text-xs text-slate-500 dark:text-slate-400" data-v-6927b0a2>选择查看数据的时间跨度</span></div></div>',1)),t("div",Hr,[t("button",{class:K(["flex flex-1 items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300",e(N)==="daily"?"bg-white text-blue-600 shadow-sm dark:bg-slate-700 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"]),disabled:e(_)||e(P),onClick:w[2]||(w[2]=Y=>e(T)("daily"))},w[10]||(w[10]=[t("i",{class:"fas fa-calendar-day"},null,-1),h(" 今日 ",-1)]),10,Gr),t("button",{class:K(["flex flex-1 items-center justify-center gap-2 rounded-lg px-4 py-2 text-sm font-medium transition-all duration-300",e(N)==="monthly"?"bg-white text-blue-600 shadow-sm dark:bg-slate-700 dark:text-blue-400":"text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-200"]),disabled:e(_)||e(P),onClick:w[3]||(w[3]=Y=>e(T)("monthly"))},w[11]||(w[11]=[t("i",{class:"fas fa-calendar-alt"},null,-1),h(" 本月 ",-1)]),10,Qr)]),e(u)?A("",!0):(r(),n("button",{key:0,class:"test-btn ml-2 hidden items-center justify-center gap-2 rounded-xl px-5 py-2.5 text-sm font-medium transition-all duration-300 hover:scale-105 active:scale-95 md:flex",disabled:e(_),onClick:V},w[12]||(w[12]=[t("i",{class:"fas fa-vial"},null,-1),t("span",null,"连通性测试",-1)]),8,Xr))]),Z(_s),t("div",Zr,[Z(Gs,{class:"h-full"}),e(u)?(r(),ot(Ml,{key:0,class:"h-full"})):(r(),ot(gl,{key:1,class:"h-full"}))]),Z(or),e(u)?A("",!0):(r(),n("div",ti,[t("button",{class:"flex h-14 w-14 items-center justify-center rounded-full bg-blue-600 text-white shadow-xl transition-all hover:bg-blue-700 active:scale-95",onClick:V},w[14]||(w[14]=[t("i",{class:"fas fa-vial text-xl"},null,-1)]))]))])):A("",!0)])):A("",!0),d.value==="tutorial"?(r(),n("div",ei,[t("div",si,[Z(Pt)])])):A("",!0),Z(Dr,{"api-key-name":((z=e(W))==null?void 0:z.name)||"","api-key-value":e(m),show:E.value,onClose:M},null,8,["api-key-name","api-key-value","show"])],2)}}},fi=at(ai,[["__scopeId","data-v-6927b0a2"]]);export{fi as default};
